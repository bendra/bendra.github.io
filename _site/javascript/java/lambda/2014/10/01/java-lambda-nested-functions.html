<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>How well can Java Lambdas serve as nested functions?</title>
    <meta name="description" content="One-stop shopping for Ben Drasin's software projects and writings/ruminations on tech.  
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://bendra.github.io/javascript/java/lambda/2014/10/01/java-lambda-nested-functions.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Benjamin Drasin</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">How well can Java Lambdas serve as nested functions?</h1>
    <p class="post-meta">Oct 1, 2014</p>
  </header>

  <article class="post-content">
    <h1 id="nested-functions">Nested Functions</h1>
<p>This article will explore how closely Java lambdas can replicate the functionality of Javascript nested functions.  Not all programing languages support nested functions at all, and so as a programmer you could go a long time without seeing them, but for some problems they can be helpful.  If you have a function which logically consists of two different sub-operations, which themselves do not make any sense outside of the context of the overall function then writing them as nested sub-functions can improve readability as opposed to, say, writing them as class/object level private functions.  An example of this would be the split and merge operations of a Merge sort, or the partition and swap operations of Quicksort.  For this article I’ll use a different example because its one which I enjoyed writing so much.</p>

<h1 id="the-javascript-code">The Javascript Code</h1>
<p>This is a function I wrote some time ago for converting numbers (conventionally represented in Arabic notation) to Roman numerals. This Javascript code isn’t the only or even necessarily the best way to do it but I liked it because it took advantage of several Javascript language features:</p>

<ol>
  <li>Nested functions for clarity</li>
  <li>Closure (access to a function’s local variable outside of its immediate lexical scope)</li>
  <li>Multiple return values from a function</li>
</ol>

<p>Here is the Javascript function:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">toRoman</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2</span>   <span class="c1">// these numbers can be converted into single Roman &quot;digits</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">toArabic</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> 
<span class="lineno"> 4</span>   <span class="c1">// ...and these are the corresponding Roman characters for them</span>
<span class="lineno"> 5</span>     <span class="nx">fromRoman</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span> <span class="p">],</span> 
<span class="lineno"> 6</span>     <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">nextVal</span><span class="p">,</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>   <span class="k">while</span> <span class="p">(</span><span class="nx">input</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 9</span>     <span class="nx">nextVal</span> <span class="o">=</span> <span class="nx">nextRomanFor</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
<span class="lineno">10</span>     <span class="nx">output</span> <span class="o">+=</span> <span class="nx">nextVal</span><span class="p">[</span><span class="s1">&#39;char&#39;</span><span class="p">];</span>
<span class="lineno">11</span>     <span class="nx">input</span> <span class="o">-=</span> <span class="nx">nextVal</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
<span class="lineno">12</span>   <span class="p">}</span>
<span class="lineno">13</span>   <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>   <span class="kd">function</span> <span class="nx">nextRomanFor</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">16</span>     <span class="kd">var</span> <span class="nx">nextNumber</span><span class="p">;</span>
<span class="lineno">17</span>     <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">toArabic</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">18</span>       <span class="nx">nextNumber</span> <span class="o">=</span> <span class="nx">toArabic</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="lineno">19</span>       <span class="c1">// return tuple of Roman-plus-Arabic-equivalent</span>
<span class="lineno">20</span>       <span class="k">if</span> <span class="p">(</span><span class="nx">nextNumber</span> <span class="o">&lt;=</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">21</span>         <span class="k">return</span> <span class="p">{</span>
<span class="lineno">22</span>           <span class="s1">&#39;char&#39;</span> <span class="o">:</span> <span class="nx">fromRoman</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
<span class="lineno">23</span>           <span class="s1">&#39;num&#39;</span> <span class="o">:</span> <span class="nx">nextNumber</span>
<span class="lineno">24</span>         <span class="p">};</span>
<span class="lineno">25</span>       <span class="p">}</span>
<span class="lineno">26</span>       <span class="c1">// now look for a subtractable combination w/this number</span>
<span class="lineno">27</span>       <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">toArabic</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">28</span>         <span class="k">if</span> <span class="p">(</span><span class="nx">isSubtractable</span><span class="p">(</span><span class="nx">toArabic</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">toArabic</span><span class="p">[</span><span class="nx">j</span><span class="p">]))</span> <span class="p">{</span>
<span class="lineno">29</span>           <span class="nx">nextNumber</span> <span class="o">=</span> <span class="nx">toArabic</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="nx">toArabic</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="lineno">30</span>           <span class="k">if</span> <span class="p">(</span><span class="nx">nextNumber</span> <span class="o">&lt;=</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">31</span>             <span class="k">return</span> <span class="p">{</span>
<span class="lineno">32</span>               <span class="s1">&#39;char&#39;</span> <span class="o">:</span> <span class="nx">fromRoman</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">+</span> <span class="nx">fromRoman</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
<span class="lineno">33</span>               <span class="s1">&#39;num&#39;</span> <span class="o">:</span> <span class="nx">nextNumber</span>
<span class="lineno">34</span>             <span class="p">};</span>
<span class="lineno">35</span>           <span class="p">}</span>
<span class="lineno">36</span>           <span class="c1">// if 1st subtractable isn&#39;t smaller, can continue</span>
<span class="lineno">37</span>           <span class="k">break</span><span class="p">;</span>
<span class="lineno">38</span>         <span class="p">}</span>
<span class="lineno">39</span>       <span class="p">}</span>
<span class="lineno">40</span>     <span class="p">}</span>
<span class="lineno">41</span>   <span class="p">}</span>
<span class="lineno">42</span> 
<span class="lineno">43</span>   <span class="kd">function</span> <span class="nx">isSubtractable</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span> <span class="nx">num2</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">44</span>     <span class="kd">var</span> <span class="nx">d</span><span class="p">;</span>
<span class="lineno">45</span> 
<span class="lineno">46</span>     <span class="c1">// num2 is subtractable from num1 if is smaller &amp; a power of 10</span>
<span class="lineno">47</span>     <span class="k">if</span> <span class="p">(</span><span class="nx">num1</span> <span class="o">&gt;</span> <span class="nx">num2</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">48</span>       <span class="c1">// obtain log10(num2)</span>
<span class="lineno">49</span>       <span class="nx">d</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="lineno">50</span>       <span class="c1">// if is a whole number, is true</span>
<span class="lineno">51</span>       <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="o">===</span> <span class="nx">d</span><span class="p">;</span>
<span class="lineno">52</span>     <span class="p">}</span>
<span class="lineno">53</span>     <span class="c1">// got here, is false</span>
<span class="lineno">54</span>     <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="lineno">55</span>   <span class="p">}</span>
<span class="lineno">56</span> <span class="p">}</span></code></pre></div>

<p>Let’s see how close Java can come to achieving the same things with the addition of Lambda syntax!</p>

<h1 id="java-lambdas">Java Lambdas</h1>

<p>Unlike Javascript, of course Java doesn’t have top-level functions; all functions must be associated with a class (static methods) or the instances of a class (object methods).   As such, there’s no direct analog for this type of construct; traditionally the closest we could come would be to use a class wrapper around a function, with a lot of unwanted verbosity.  However, as of JDK 1.8, we have a Lambda construct which can work in a similar fashion to a nested function (although as we will see later, the pre-existing baggage of a wrapper class is still there although hidden at development time).  A lambda is declared using the following syntax:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Function</span><span class="o">&lt;</span><span class="n">InputType</span><span class="o">,</span> <span class="n">ReturnType</span><span class="o">&gt;</span> <span class="n">myFunction</span> <span class="o">=</span> <span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="c1">//arg is of type InputType </span>
  <span class="c1">//code block, doSomething, return value of type ReturnType</span>
<span class="o">}</span></code></pre></div>

<p>This would be analogous to creating a Javascript function using a variable-assigned function:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">myFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">){</span>
  <span class="c1">//do something, If no explicit return, last evaluated statement supplies return value</span>
<span class="p">}</span></code></pre></div>

<p>A consequence of this is that the variable can’t be used until it is assigned, and so the helper functions need to appear at the top of the method, before the code which uses them.  This isn’t a severe shortcoming; Javascript is almost alone in allowing this type of construction (Haskell is the only other one I know of.  Scala technically allows this construction but in practice you <a href="https://groups.google.com/forum/#!topic/scala-language/7_c2VpHexEM">can’t really use it</a>).</p>

<h1 id="first-try">First Try</h1>

<p>The closest and most straightforward implementation of this algorithm in Java would look like this:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toRoman</span><span class="o">(</span><span class="kt">int</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// running count of how much we have left</span>
  <span class="kt">int</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">input</span><span class="o">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="n">StringBuffer</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">();</span>

  <span class="c1">// num2 is subtractable from num1 if is smaller &amp; a power of 10</span>
  <span class="n">BiPredicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">isSubtractable</span> <span class="o">=</span> <span class="o">(</span><span class="n">num1</span><span class="o">,</span> <span class="n">num2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">num1</span> <span class="o">&gt;</span> <span class="n">num2</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">num2</span><span class="o">)</span> <span class="o">/</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
      <span class="k">return</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">d</span><span class="o">))</span> <span class="o">==</span> <span class="n">d</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">};</span>

  <span class="c1">// In Java, to return multiple values must use array or collection</span>
  <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]&gt;</span> <span class="n">nextRomanFor</span> <span class="o">=</span> <span class="o">(</span><span class="n">num</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">nextNumber</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">intToRoman</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">nextNumber</span> <span class="o">=</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">nextNumber</span> <span class="o">&lt;=</span> <span class="n">remainder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">romanFromInt</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">nextNumber</span> <span class="o">};</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

        <span class="c1">// try to find a subtractable combination to return</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">intToRoman</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">isSubtractable</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">intToRoman</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">j</span><span class="o">]))</span> <span class="o">{</span>
            <span class="n">nextNumber</span> <span class="o">=</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">nextNumber</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span>
                  <span class="n">romanFromInt</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="n">romanFromInt</span><span class="o">[</span><span class="n">i</span><span class="o">],</span>
                  <span class="n">nextNumber</span> <span class="o">};</span>
            <span class="o">}</span>
            <span class="c1">// if the largest subtractable number doesn&#39;t work,</span>
            <span class="c1">// we can exit loop</span>
            <span class="k">break</span><span class="o">;</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// should never happen!</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">};</span>

  <span class="k">while</span> <span class="o">(</span><span class="n">remainder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 1st return val is Roman numeral, 2nd is corresponding int value</span>
    <span class="n">Object</span><span class="o">[]</span> <span class="n">returnVal</span> <span class="o">=</span> <span class="n">nextRomanFor</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">remainder</span><span class="o">);</span>
    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">returnVal</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="n">remainder</span> <span class="o">-=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">returnVal</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Not so bad; the line count of the function is actually smaller than the Javascript version!  Of course with Java we’ll have the additional overhead of the method signature, but still it will be close.  Unfortunately this code won’t compile:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">error: local variables referenced from a lambda expression must be final or effectively final</span>
<span class="go">                        for (; i &lt; intToRoman.length; i++) {</span>
<span class="go">                               ^</span>
<span class="go">error: local variables referenced from a lambda expression must be final or effectively final</span>
<span class="go">                                if (nextNumber &lt;= remainder){</span>
<span class="go">                                                  ^</span></code></pre></div>

<p>The reason for this is that lambdas in Java are implemented by, at compile time, generating anonymous classes implementing predefined Functional Interfaces.  As a consequence, in order for the local variables (in this case remainder and output) to be accessible inside of the lambda expressions they must be marked final:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">3
4</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">final</span> <span class="kt">int</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">input</span><span class="o">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> 
    <span class="kd">final</span> <span class="n">StringBuffer</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">();</span>
</pre></div>
</td></tr></table>

<p>But now our method won’t compile for another reason:</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">error: cannot assign a value to final variable i</span>
<span class="go">                        for (; i &lt; intToRoman.length; i++) {</span>
<span class="go">                                                      ^</span>
<span class="go">error: cannot assign a value to final variable remainder</span>
<span class="go">                        remainder -= (Integer)returnVal[1];</span>
<span class="go">                        ^</span></code></pre></div>

<p>This is because the final modifier not only makes our variables accessible to the lambda function it also becomes, well, final and so it can’t be assigned.  Furthermore in Java an int is a primitive type and can’t have its value modified (and its corresponding type Integer is immutable and final).  So what to do?</p>

<h1 id="array-as-a-primitive-by-reference">Array as a primitive-by-reference</h1>

<p>One solution is to use a trick that Java programmers have long used when they’ve needed pass-by-reference behavior for an argument to a method with a primitive value, namely to use a single-element array reference, and change the rest of the code as appropriate e.g.:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">3</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">remainder</span> <span class="o">=</span> <span class="o">{</span> <span class="n">input</span> <span class="o">},</span> <span class="n">i</span> <span class="o">=</span> <span class="o">{</span><span class="mi">0</span><span class="o">};</span>
</pre></div>
</td></tr></table>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">41</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="k">for</span> <span class="o">(;</span> <span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">intToRoman</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]++){</span>
</pre></div>
</td></tr></table>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">72</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">remainder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">returnVal</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
</pre></div>
</td></tr></table>

<p>This makes the code a bit ugly but works just fine.  </p>

<h1 id="mutable-primitve-wrapper">Mutable primitve wrapper</h1>

<p>Another alternative would be to use a mutable reference with an int value like AtomicInteger from java.util.concurrent.  Again this is doable but it is rather verbose, for example:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">3</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">final</span> <span class="n">AtomicInteger</span> <span class="n">remainder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AtomicInteger</span><span class="o">(</span><span class="n">input</span><span class="o">),</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</pre></div>
</td></tr></table>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">41</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="k">for</span> <span class="o">(;</span> <span class="n">i</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">intToRoman</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">())</span> <span class="o">{</span>
</pre></div>
</td></tr></table>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">72</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">remainder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span> <span class="n">remainder</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">-</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">returnVal</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
</pre></div>
</td></tr></table>

<h1 id="java-function-vs-consumer">Java Function vs Consumer</h1>

<p>Another difference between the Java and Javascript code is in the return value from the nextRomanFor() function: in Javascript the function returns an associative array in the form of an object created on-the fly.  Because of Java’s strong typing and lack of tuple syntax there’s no analogous approach; what we can do is either return an array of Object[], as we did in example1, or create/appropriate another type for the multiple return values (many developers use java.util.Map.Entry as a two-item pseudo-tuple).  In this case there is another solution, which is to simply remove the return value for the function and do the assignment directly in nextRomanFor():</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">nextRomanFor</span> <span class="o">=</span> <span class="o">(</span><span class="n">num</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">nextNumber</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(;</span> <span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">intToRoman</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]++)</span> <span class="o">{</span>
        <span class="n">nextNumber</span> <span class="o">=</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]];</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nextNumber</span> <span class="o">&lt;=</span> <span class="n">remainder</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span> <span class="o">{</span>
          <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">romanFromInt</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]]);</span>
          <span class="n">remainder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-=</span> <span class="n">nextNumber</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="c1">// try to find a subtractable combination to return</span>
          <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">intToRoman</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">isSubtractable</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">intToRoman</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]],</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">j</span><span class="o">]))</span> <span class="o">{</span>
              <span class="c1">// compound roman number, large value on right minus</span>
              <span class="c1">// small value on left</span>
              <span class="n">nextNumber</span> <span class="o">=</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]]</span> <span class="o">-</span> <span class="n">intToRoman</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
              <span class="k">if</span> <span class="o">(</span><span class="n">nextNumber</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">romanFromInt</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="n">romanFromInt</span><span class="o">[</span><span class="n">i</span><span class="o">[</span><span class="mi">0</span><span class="o">]]);</span>
                <span class="n">remainder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">-=</span> <span class="n">nextNumber</span><span class="o">;</span>
              <span class="o">}</span>
              <span class="c1">// if the largest subtractable number doesn&#39;t work,</span>
              <span class="c1">// we can exit loop</span>
              <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">};</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">remainder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 1st return val is Roman numeral, 2nd is corresponding int value</span>
      <span class="n">nextRomanFor</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">remainder</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Note that to do this we have to:</p>

<ol>
  <li>Change the type of the lambda expression from Function to Consumer (a Consumer is a lambda with no return value)</li>
  <li>Change the code which calls the lambda expression to accept() instead of apply()</li>
</ol>

<h1 id="conclusion">Conclusion</h1>

<p>Overall, Java nested functions can approximate the functionality of what true nested functions offer in a language like Javascript, however in many scenarios the shoe-horned nature of the solution becomes apparent.  This example to my eye and experience results in some awkward looking and not necessarily intuitive patterns.</p>

<p>These patterns will make sense to an experienced Java developer and won’t present a problem for them,  however in terms of attracting and gaining mind share among junior developers they represent another hurdle to overcome.  Java is no longer a small or simple language, and developers want to spend their time developing application code and not on learning patterns forced upon them by the idiosyncrasies of a programing language.</p>

<p>For an experienced Java developer, these considerations are minor compared to the question of how the new syntax affects application development, particularly web and network applications based on the increasingly popular asynchronous I/O model.  I’ll explore this in a later article! </p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Benjamin Drasin</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Benjamin Drasin</li>
          <li><a href="mailto:bdrasin@gmail.com">bdrasin@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/bendra">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">bendra</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/uther_bendragon">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">uther_bendragon</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">One-stop shopping for Ben Drasin's software projects and writings/ruminations on tech.  
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
